<!DOCTYPE html>
<html>
<head>
    <title>Pricing Calculator</title>
    <style>
        table, th, td { border: 1px solid #ccc; border-collapse: collapse; padding: 6px; }
        th { background: #f0f0f0; }
    </style>
</head>
<body>
    <h1>Pricing Calculator</h1>

    {% if step == 'volumes' %}
    <form method="post">
        <input type="hidden" name="step" value="volumes">
        <label>Country:</label>
        <select name="country">
            <option value="India">India</option>
            <option value="MENA">MENA</option>
            <option value="LATAM">LATAM</option>
            <option value="Africa">Africa</option>
            <option value="Europe">Europe</option>
            <option value="Rest of the World">Rest of the World</option>
        </select><br><br>
        <label>AI Message Volume (per month):</label>
        <input type="number" name="ai_volume" required><br><br>
        <label>Advanced Message Volume (per month):</label>
        <input type="number" name="advanced_volume" required><br><br>
        <label>Basic Marketing Message Volume (per month):</label>
        <input type="number" name="basic_marketing_volume" required><br><br>
        <label>Basic Utility/Authentication Message Volume (per month):</label>
        <input type="number" name="basic_utility_volume" required><br><br>
        <label>Platform Fee:</label>
        {{ currency_symbol }}<input type="number" name="platform_fee" required><br>
        <small>Enter the platform fee in the selected country's currency.</small><br><br>
        <input type="submit" value="Next: Suggest Prices">
    </form>
    {% endif %}

    {% if step == 'prices' %}
    <form method="post">
        <input type="hidden" name="step" value="prices">
        <h2>Suggested Gupshup Fee on top of channel costs(edit if needed)</h2>
        <label>AI Message Price:</label>
        {{ currency_symbol }}<input type="number" step="0.0001" name="ai_price" value="{{ suggested.ai_price }}" required><br><br>
        <label>Advanced Message Price:</label>
        {{ currency_symbol }}<input type="number" step="0.0001" name="advanced_price" value="{{ suggested.advanced_price }}" required><br><br>
        <label>Basic Marketing Message Price:</label>
        {{ currency_symbol }}<input type="number" step="0.0001" name="basic_marketing_price" value="{{ suggested.basic_marketing_price }}" required><br><br>
        <label>Basic Utility/Authentication Message Price:</label>
        {{ currency_symbol }}<input type="number" step="0.0001" name="basic_utility_price" value="{{ suggested.basic_utility_price }}" required><br><br>
        <input type="submit" value="Calculate Results">
    </form>
    <form method="get">
        <input type="submit" value="Back to Volumes">
    </form>
    {% endif %}

    {% if step == 'results' %}
        <h2>Results</h2>
        <table>
            <tr>
                <th>Line Item</th>
                <th>Volume</th>
                <th>Chosen Price/message</th>
                <th>Suggested Price/message</th>
                <th>Overage Price/message</th>
                <th>Revenue (Chosen) {{ currency_symbol }}/month</th>
                <th>Revenue (Suggested) {{ currency_symbol }}/month</th>
            </tr>
            {% for item in results.line_items %}
            <tr>
                <td>{{ item.label }}</td>
                <td>{{ item.volume }}</td>
                <td>{{ item.chosen_price }}</td>
                <td>{{ item.suggested_price }}</td>
                <td>{{ item.overage_price }}</td>
                <td>{{ item.revenue|round(2) }}</td>
                <td>{{ item.suggested_revenue|round(2) }}</td>
            </tr>
            {% endfor %}
        </table>
        <br>
        <table>
            <tr><th>Platform Fee/month</th><td>{{ results.platform_fee }}</td></tr>
            <tr><th>Total Revenue (Chosen) {{ currency_symbol }}/month</th><td>{{ results.revenue }}</td></tr>
            <tr><th>Total Revenue (Suggested) {{ currency_symbol }}/month</th><td>{{ results.suggested_revenue }}</td></tr>
            <tr><th>Channel Cost</th><td>{{ results.channel_cost }}</td></tr>
            <tr><th>AI Costs {{ currency_symbol }}/month</th><td>{{ results.ai_costs }}</td></tr>
            <tr><th>Total Costs {{ currency_symbol }}/month</th><td>{{ results.total_costs }}</td></tr>
            <tr><th>Margin (User Chosen)</th><td>{{ results.margin }}</td></tr>
            <tr><th>Margin (Suggested)</th><td>{{ results.suggested_margin }}</td></tr>
        </table>
        <br>
        <form method="get">
            <input type="submit" value="Start Over">
        </form>
    {% endif %}
</body>
</html>